<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>数据分析-学习效果评估</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
		<link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
		<link rel="stylesheet" href="../css/public.css" media="all">
	</head>
	<body>
		<div class="layuimini-container">
			<div class="layuimini-main">
				<fieldset class="table-search-fieldset">
					<legend>查询条件</legend>
					<div style="margin: 10px;">
						<form class="layui-form layui-form-pane" action="">
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">课程名称</label>
									<div class="layui-input-inline">
										<input type="text" name="courseName" autocomplete="off" class="layui-input">
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">评估周期</label>
									<div class="layui-input-inline">
										<select name="period">
											<option value="">全部周期</option>
											<option value="week">近一周</option>
											<option value="month">近一月</option>
										</select>
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">完成状态</label>
									<div class="layui-input-inline">
										<select name="status">
											<option value="">全部状态</option>
											<option value="completed">已完成</option>
											<option value="inprogress">进行中</option>
										</select>
									</div>
								</div>
								<div class="layui-inline">
									<button type="submit" class="layui-btn layui-btn-primary" lay-submit
										lay-filter="searchBtn">
										<i class="layui-icon"></i> 搜索
									</button>
								</div>
							</div>
						</form>
					</div>
				</fieldset>

				<script type="text/html" id="toolbarDemo">
					<div class="layui-btn-container">
						<button class="layui-btn layui-btn-normal layui-btn-sm" lay-event="export">导出评估报告</button>
					</div>
				</script>

				<table class="layui-hide" id="evaluationTable" lay-filter="evaluationTableFilter"></table>

				<script type="text/html" id="evaluationBar">
					<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="detail">查看详情</a>
					<a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="improve">提升建议</a>
				</script>
			</div>
		</div>

		<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
		<script>
			layui.use(['form', 'table', 'layer'], function() {
				var $ = layui.jquery,
					form = layui.form,
					table = layui.table,
					layer = layui.layer;

				// 渲染表格
				table.render({
					elem: '#evaluationTable',
					url: '../api/evaluation-data.json',
					toolbar: '#toolbarDemo',
					defaultToolbar: ['filter', 'exports', 'print'],
					cols: [
						[{
								type: "checkbox",
								width: 50
							},
							{
								field: 'id',
								width: 80,
								title: 'ID',
								sort: true
							},
							{
								field: 'courseName',
								width: 250,
								title: '课程名称'
							},
							{
								field: 'progress',
								width: 100,
								title: '完成进度',
								templet: function(d) {
									return d.progress + '%';
								}
							},
							{
								field: 'mastery',
								width: 100,
								title: '掌握程度',
								sort: true
							},
							{
								field: 'lastStudy',
								width: 160,
								title: '最近学习时间'
							},
							{
								field: 'status',
								width: 100,
								title: '状态',
								templet: function(d) {
									var color = d.status === 'completed' ? 'green' : 'orange';
									var text = d.status === 'completed' ? '已完成' : '进行中';
									return '<span style="color:' + color + '">' + text + '</span>';
								}
							},
							{
								title: '操作',
								minWidth: 150,
								toolbar: '#evaluationBar',
								align: "center"
							}
						]
					],
					limits: [10, 15, 20],
					limit: 10,
					page: true,
					skin: 'line'
				});

				// 监听搜索
				form.on('submit(searchBtn)', function(data) {
					// 执行搜索重载
					table.reload('evaluationTable', {
						page: {
							curr: 1
						},
						where: data.field
					});
					return false;
				});

				// 监听工具条
				table.on('tool(evaluationTableFilter)', function(obj) {
					var data = obj.data;
					if (obj.event === 'detail') {
						// 构建详情信息对象
						var info = {
							"课程名称": data.courseName,
							"完成进度": data.progress + "%",
							"掌握程度": data.mastery,
							"最近学习时间": data.lastStudy,
							"学习状态": data.status === 'completed' ? '已完成' : '进行中'
						};

						// 转换为格式化的JSON字符串
						var jsonStr = JSON.stringify(info, null, 2);
						layer.open({
							title: '评估详情',
							content: jsonStr,
							area: ['500px', '300px'],
							btn: ['确定'],
							btnAlign: 'c'
						});
					} else if (obj.event === 'improve') {
						layer.alert('《' + data.courseName + '》提升建议：<br>' +
							'1. 加强薄弱知识学习<br>' +
							'2. 完成剩余' + (100 - data.progress) + '%课程内容', {
								title: '学习提升建议'
							});
					}
				});

				// 监听工具栏
				table.on('toolbar(evaluationTableFilter)', function(obj) {
					if (obj.event === 'export') {
						layer.confirm('确定导出评估报告？', function(index) {
							layer.close(index);
							layer.msg('报告导出中...', {
								icon: 16,
								time: 2000
							}, function() {
								layer.msg('报告导出成功', {
									icon: 1
								});
							});
						});
					}
				});
			});
		</script>
	</body>
</html>