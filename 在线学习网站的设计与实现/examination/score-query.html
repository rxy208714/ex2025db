<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>考试测评-成绩查询</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
		<link rel="stylesheet" href="../lib/font-awesome-4.7.0/css/font-awesome.min.css" media="all">
		<link rel="stylesheet" href="../css/public.css" media="all">
	</head>
	<body>
		<div class="layuimini-container">
			<div class="layuimini-main">
				<fieldset class="table-search-fieldset">
					<legend>查询条件</legend>
					<div style="margin: 10px 10px 10px 10px">
						<form class="layui-form layui-form-pane" action="">
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">课程名称</label>
									<div class="layui-input-inline">
										<select name="courseId" lay-search>
											<option value="">全部课程</option>
											<option value="1">Web前端开发实战（HTML/CSS/JS）</option>
											<option value="2">Python自动化办公入门到精通</option>
											<option value="3">Java后端开发（Spring Boot 框架）</option>
											<option value="4">短视频剪辑与运营（Pr+剪映）</option>
											<option value="5">数据分析与可视化（Excel+Tableau）</option>
											<option value="6">移动端APP开发（Flutter跨平台）</option>
											<option value="7">UI设计基础（Figma实战）</option>
											<option value="8">MySQL数据库优化与性能调优</option>
											<option value="9">跨境电商运营（亚马逊开店实战）</option>
											<option value="10">人工智能基础（机器学习入门）</option>
										</select>
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">考试状态</label>
									<div class="layui-input-inline">
										<select name="status">
											<option value="">全部状态</option>
											<option value="已完成">已完成</option>
											<option value="未开始">未开始</option>
											<option value="进行中">进行中</option>
										</select>
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">考试时间</label>
									<div class="layui-input-inline">
										<input type="text" name="examDate" placeholder="选择日期范围" autocomplete="off"
											class="layui-input">
									</div>
								</div>
								<div class="layui-inline">
									<button type="submit" class="layui-btn layui-btn-primary" lay-submit
										lay-filter="data-search-btn">
										<i class="layui-icon"></i> 查询
									</button>
								</div>
							</div>
						</form>
					</div>
				</fieldset>

				<table class="layui-hide" id="scoreTable" lay-filter="scoreTableFilter"></table>

				<script type="text/html" id="scoreBar">
					<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="view">查看详情</a>
					<a class="layui-btn layui-btn-warm layui-btn-xs" lay-event="reexam">重新考试</a>
				</script>
			</div>
		</div>

		<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
		<script>
			layui.use(['form', 'table', 'laydate'], function() {
				var $ = layui.jquery,
					form = layui.form,
					table = layui.table,
					laydate = layui.laydate;

				// 初始化日期范围选择
				laydate.render({
					elem: '[name="examDate"]',
					range: true
				});

				// 渲染表格
				table.render({
					elem: '#scoreTable',
					url: '../api/exam-scores.json', // 实际项目中替换为真实接口
					toolbar: '#toolbarDemo',
					defaultToolbar: ['filter', 'exports', 'print'],
					cols: [
						[{
								type: "checkbox",
								width: 50
							},
							{
								field: 'id',
								width: 80,
								title: 'ID',
								sort: true
							},
							{
								field: 'courseName',
								width: 300,
								title: '课程名称'
							},
							{
								field: 'examDate',
								width: 160,
								title: '考试时间'
							},
							{
								field: 'score',
								width: 80,
								title: '得分',
								sort: true
							},
							{
								field: 'totalScore',
								width: 80,
								title: '总分'
							},
							{
								field: 'rank',
								width: 80,
								title: '排名',
								sort: true
							},
							{
								field: 'passingScore',
								width: 80,
								title: '及格线'
							},
							{
								field: 'status',
								width: 100,
								title: '考试状态',
								templet: function(d) {
									if (d.status === '已完成') {
										return d.score >= d.passingScore ?
											'<span style="color:green">已通过</span>' :
											'<span style="color:red">未通过</span>';
									} else if (d.status === '进行中') {
										return '<span style="color:orange">进行中</span>';
									} else {
										return '<span style="color:gray">未开始</span>';
									}
								}
							},
							{
								title: '操作',
								minWidth: 160,
								toolbar: '#scoreBar',
								align: "center"
							}
						]
					],
					limits: [10, 15, 20, 25],
					limit: 10,
					page: true,
					skin: 'line'
				});

				// 监听搜索操作
				form.on('submit(data-search-btn)', function(data) {
					// 执行搜索重载
					table.reload('scoreTable', {
						page: {
							curr: 1
						},
						where: data.field
					});
					return false;
				});

				// 监听表格操作
				table.on('tool(scoreTableFilter)', function(obj) {
					var data = obj.data;
					if (obj.event === 'view') {
						var info = {
							"课程名称": data.courseName,
							"考试时间": data.examDate,
							"得分": data.score,
							"总分": data.totalScore,
							"排名": data.rank,
							"及格线": data.passingScore,
							"考试状态": data.status
						};
						var jsonStr = JSON.stringify(info, null, 2);
						layer.open({
							title: '考试成绩详情',
							content: jsonStr,
							area: ['500px', '200px'], 
							btn: ['确定'],
							btnAlign: 'c', 
						});

					} else if (obj.event === 'reexam') {
						layer.confirm('确定要重新参加该考试吗？之前的成绩将被覆盖', function(index) {
							layer.close(index);
							// 跳转到对应课程的考试页面
							parent.layui.miniTab.open({
								title: "在线考试",
								url: "online-exam.html?courseId=" + data.courseId,
								icon: "fa fa-pencil"
							});
						});
					}
				});
			});
		</script>
	</body>
</html>
